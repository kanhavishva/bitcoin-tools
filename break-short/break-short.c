#include "libsecp256k1-config.h"

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <pthread.h>

#include "include/secp256k1.h"
#include "secp256k1.c"

#define TIME
//#define EXPONENT64

#ifdef TIME
#include <time.h>
#endif

#define NUMPUBKEYS 90
unsigned char rawpubkeys[NUMPUBKEYS][33] = {
{0x02,0x79,0xbe,0x66,0x7e,0xf9,0xdc,0xbb,0xac,0x55,0xa0,0x62,0x95,0xce,0x87,0x0b,0x07,0x02,0x9b,0xfc,0xdb,0x2d,0xce,0x28,0xd9,0x59,0xf2,0x81,0x5b,0x16,0xf8,0x17,0x98},//== #1
{0x02,0xf9,0x30,0x8a,0x01,0x92,0x58,0xc3,0x10,0x49,0x34,0x4f,0x85,0xf8,0x9d,0x52,0x29,0xb5,0x31,0xc8,0x45,0x83,0x6f,0x99,0xb0,0x86,0x01,0xf1,0x13,0xbc,0xe0,0x36,0xf9},//== #2
{0x02,0x5c,0xbd,0xf0,0x64,0x6e,0x5d,0xb4,0xea,0xa3,0x98,0xf3,0x65,0xf2,0xea,0x7a,0x0e,0x3d,0x41,0x9b,0x7e,0x03,0x30,0xe3,0x9c,0xe9,0x2b,0xdd,0xed,0xca,0xc4,0xf9,0xbc},//== #3
{0x02,0x2f,0x01,0xe5,0xe1,0x5c,0xca,0x35,0x1d,0xaf,0xf3,0x84,0x3f,0xb7,0x0f,0x3c,0x2f,0x0a,0x1b,0xdd,0x05,0xe5,0xaf,0x88,0x8a,0x67,0x78,0x4e,0xf3,0xe1,0x0a,0x2a,0x01},//== #4
{0x02,0x35,0x2b,0xbf,0x4a,0x4c,0xdd,0x12,0x56,0x4f,0x93,0xfa,0x33,0x2c,0xe3,0x33,0x30,0x1d,0x9a,0xd4,0x02,0x71,0xf8,0x10,0x71,0x81,0x34,0x0a,0xef,0x25,0xbe,0x59,0xd5},//== #5
{0x03,0xf2,0xda,0xc9,0x91,0xcc,0x4c,0xe4,0xb9,0xea,0x44,0x88,0x7e,0x5c,0x7c,0x0b,0xce,0x58,0xc8,0x00,0x74,0xab,0x9d,0x4d,0xba,0xeb,0x28,0x53,0x1b,0x77,0x39,0xf5,0x30},//== #6
{0x02,0x96,0x51,0x6a,0x8f,0x65,0x77,0x42,0x75,0x27,0x8d,0x0d,0x74,0x20,0xa8,0x8d,0xf0,0xac,0x44,0xbd,0x64,0xc7,0xba,0xe0,0x7c,0x3f,0xe3,0x97,0xc5,0xb3,0x30,0x0b,0x23},//== #7
{0x03,0x08,0xbc,0x89,0xc2,0xf9,0x19,0xed,0x15,0x88,0x85,0xc3,0x56,0x00,0x84,0x4d,0x49,0x89,0x09,0x05,0xc7,0x9b,0x35,0x73,0x22,0x60,0x9c,0x45,0x70,0x6c,0xe6,0xb5,0x14},//== #8
{0x02,0x43,0x60,0x1d,0x61,0xc8,0x36,0x38,0x74,0x85,0xe9,0x51,0x4a,0xb5,0xc8,0x92,0x4d,0xd2,0xcf,0xd4,0x66,0xaf,0x34,0xac,0x95,0x00,0x27,0x27,0xe1,0x65,0x9d,0x60,0xf7},//== #9
{0x03,0xa7,0xa4,0xc3,0x02,0x91,0xac,0x1d,0xb2,0x4b,0x4a,0xb0,0x0c,0x44,0x2a,0xa8,0x32,0xf7,0x79,0x4b,0x5a,0x09,0x59,0xbe,0xc6,0xe8,0xd7,0xfe,0xe8,0x02,0x28,0x9d,0xcd},//== #10
{0x03,0x8b,0x05,0xb0,0x60,0x3a,0xbd,0x75,0xb0,0xc5,0x74,0x89,0xe4,0x51,0xf8,0x11,0xe1,0xaf,0xe5,0x4a,0x87,0x15,0x04,0x5c,0xdf,0x48,0x88,0x33,0x3f,0x3e,0xbc,0x6e,0x8b},//== #11
{0x03,0x8b,0x00,0xfc,0xbf,0xc1,0xa2,0x03,0xf4,0x4b,0xf1,0x23,0xfc,0x7f,0x4c,0x91,0xc1,0x0a,0x85,0xc8,0xea,0xe9,0x18,0x7f,0x9d,0x22,0x24,0x2b,0x46,0x00,0xce,0x78,0x1c},//== #12
{0x03,0xaa,0xda,0xaa,0xb1,0xdb,0x8d,0x5d,0x45,0x0b,0x51,0x17,0x89,0xc3,0x7e,0x7c,0xfe,0xb0,0xeb,0x8b,0x3e,0x61,0xa5,0x7a,0x34,0x16,0x6c,0x5e,0xdc,0x9a,0x4b,0x86,0x9d},//== #13
{0x03,0xb4,0xf1,0xde,0x58,0xb8,0xb4,0x1a,0xfe,0x9f,0xd4,0xe5,0xff,0xbd,0xaf,0xae,0xab,0x86,0xc5,0xdb,0x47,0x69,0xc1,0x5d,0x6e,0x60,0x11,0xae,0x73,0x51,0xe5,0x47,0x59},//== #14
{0x02,0xfe,0xa5,0x8f,0xfc,0xf4,0x95,0x66,0xf6,0xe9,0xe9,0x35,0x0c,0xf5,0xbc,0xa2,0x86,0x13,0x12,0xf4,0x22,0x96,0x6e,0x8d,0xb1,0x60,0x94,0xbe,0xb1,0x4d,0xc3,0xdf,0x2c},//== #15
{0x02,0x9d,0x8c,0x5d,0x35,0x23,0x1d,0x75,0xeb,0x87,0xfd,0x2c,0x5f,0x05,0xf6,0x52,0x81,0xed,0x95,0x73,0xdc,0x41,0x85,0x32,0x88,0xc6,0x2e,0xe9,0x4e,0xb2,0x59,0x0b,0x7a},//== #16
{0x03,0x3f,0x68,0x8b,0xae,0x83,0x21,0xb8,0xe0,0x2b,0x7e,0x6c,0x0a,0x55,0xc2,0x51,0x5f,0xb2,0x5a,0xb9,0x7d,0x85,0xfd,0xa8,0x42,0x44,0x9f,0x7b,0xfa,0x04,0xe1,0x28,0xc3},//== #17
{0x02,0x0c,0xe4,0xa3,0x29,0x1b,0x19,0xd2,0xe1,0xa7,0xbf,0x73,0xee,0x87,0xd3,0x0a,0x6b,0xdb,0xc7,0x2b,0x20,0x77,0x1e,0x7d,0xff,0xf4,0x0d,0x0d,0xb7,0x55,0xcd,0x4a,0xf1},//== #18
{0x03,0x85,0x66,0x3c,0x8b,0x2f,0x90,0x65,0x9e,0x1c,0xca,0xb2,0x01,0x69,0x4f,0x4f,0x8e,0xc2,0x4b,0x37,0x49,0xcf,0xe5,0x03,0x0c,0x7c,0x36,0x46,0xa7,0x09,0x40,0x8e,0x19},//== #19
{0x03,0x3c,0x4a,0x45,0xcb,0xd6,0x43,0xff,0x97,0xd7,0x7f,0x41,0xea,0x37,0xe8,0x43,0x64,0x8d,0x50,0xfd,0x89,0x4b,0x86,0x4b,0x0d,0x52,0xfe,0xbc,0x62,0xf6,0x45,0x4f,0x7c},//== #20
{0x03,0x1a,0x74,0x6c,0x78,0xf7,0x27,0x54,0xe0,0xbe,0x04,0x61,0x86,0xdf,0x8a,0x20,0xcd,0xce,0x5c,0x79,0xb2,0xed,0xa7,0x60,0x13,0xc6,0x47,0xaf,0x08,0xd3,0x06,0xe4,0x9e},//== #21
{0x02,0x3e,0xd9,0x6b,0x52,0x4d,0xb5,0xff,0x4f,0xe0,0x07,0xce,0x73,0x03,0x66,0x05,0x2b,0x7c,0x51,0x1d,0xc5,0x66,0x22,0x7d,0x92,0x90,0x70,0xb9,0xce,0x91,0x7a,0xbb,0x43},//== #22
{0x03,0xf8,0x27,0x10,0x36,0x1b,0x8b,0x81,0xbd,0xed,0xb1,0x69,0x94,0xf3,0x0c,0x80,0xdb,0x52,0x24,0x50,0xa9,0x3e,0x8e,0x87,0xee,0xb0,0x7f,0x79,0x03,0xcf,0x28,0xd0,0x4b},//== #23
{0x03,0x6e,0xa8,0x39,0xd2,0x28,0x47,0xee,0x1d,0xce,0x3b,0xfc,0x5b,0x11,0xf6,0xcf,0x78,0x5b,0x06,0x82,0xdb,0x58,0xc3,0x5b,0x63,0xd1,0x34,0x2e,0xb2,0x21,0xc3,0x49,0x0c},//== #24
{0x03,0x05,0x7f,0xbe,0xa3,0xa2,0x62,0x33,0x82,0x62,0x8d,0xde,0x55,0x6b,0x2a,0x06,0x98,0xe3,0x24,0x28,0xd3,0xcd,0x22,0x5f,0x3b,0xd0,0x34,0xdc,0xa8,0x2d,0xd7,0x45,0x5a},//== #25
{0x02,0x4e,0x4f,0x50,0xa2,0xa3,0xec,0xcd,0xb3,0x68,0x98,0x8a,0xe3,0x7c,0xd4,0xb6,0x11,0x69,0x7b,0x26,0xb2,0x96,0x96,0xe4,0x2e,0x06,0xd7,0x13,0x68,0xb4,0xf3,0x84,0x0f},//== #26
{0x03,0x1a,0x86,0x4b,0xae,0x39,0x22,0xf3,0x51,0xf1,0xb5,0x7c,0xfd,0xd8,0x27,0xc2,0x5b,0x7e,0x09,0x3c,0xb9,0xc8,0x8a,0x72,0xc1,0xcd,0x89,0x3d,0x9f,0x90,0xf4,0x4e,0xce},//== #27
{0x03,0xe9,0xe6,0x61,0x83,0x8a,0x96,0xa6,0x53,0x31,0x63,0x7e,0x2a,0x3e,0x94,0x8d,0xc0,0x75,0x6e,0x50,0x09,0xe7,0xcb,0x5c,0x36,0x66,0x4d,0x9b,0x72,0xdd,0x18,0xc0,0xa7},//== #28
{0x02,0x6c,0xaa,0xd6,0x34,0x38,0x2d,0x34,0x69,0x1e,0x3b,0xef,0x43,0xed,0x4a,0x12,0x4d,0x89,0x09,0xa8,0xa3,0x36,0x2f,0x91,0xf1,0xd2,0x0a,0xba,0xaf,0x7e,0x91,0x7b,0x36},//== #29
{0x03,0x0d,0x28,0x2c,0xf2,0xff,0x53,0x6d,0x2c,0x42,0xf1,0x05,0xd0,0xb8,0x58,0x88,0x21,0xa9,0x15,0xdc,0x3f,0x9a,0x05,0xbd,0x98,0xbb,0x23,0xaf,0x67,0xa2,0xe9,0x2a,0x5b},//== #30
{0x03,0x87,0xdc,0x70,0xdb,0x18,0x06,0xcd,0x9a,0x9a,0x76,0x63,0x74,0x12,0xec,0x11,0xdd,0x99,0x8b,0xe6,0x66,0x58,0x48,0x49,0xb3,0x18,0x5f,0x7f,0x93,0x13,0xc8,0xfd,0x28},//== #31
{0x02,0x09,0xc5,0x82,0x40,0xe5,0x0e,0x3b,0xa3,0xf8,0x33,0xc8,0x26,0x55,0xe8,0x72,0x5c,0x03,0x7a,0x22,0x94,0xe1,0x4c,0xf5,0xd7,0x3a,0x5d,0xf8,0xd5,0x61,0x59,0xde,0x69},//== #32
{0x03,0xa3,0x55,0xaa,0x5e,0x2e,0x09,0xdd,0x44,0xbb,0x46,0xa4,0x72,0x2e,0x93,0x36,0xe9,0xe3,0xee,0x4e,0xe4,0xe7,0xb7,0xa0,0xcf,0x57,0x85,0xb2,0x83,0xbf,0x2a,0xb5,0x79},//== #33
{0x03,0x3c,0xdd,0x9d,0x6d,0x97,0xcb,0xfe,0x7c,0x26,0xf9,0x02,0xfa,0xf6,0xa4,0x35,0x78,0x0f,0xe6,0x52,0xe1,0x59,0xec,0x95,0x36,0x50,0xec,0x7b,0x10,0x04,0x08,0x27,0x90},//== #34
{0x02,0xf6,0xa8,0x14,0x8a,0x62,0x32,0x0e,0x14,0x9c,0xb1,0x5c,0x54,0x4f,0xe8,0xa2,0x5a,0xb4,0x83,0xa0,0x09,0x5d,0x22,0x80,0xd0,0x3b,0x8a,0x00,0xa7,0xfe,0xad,0xa1,0x3d},//== #35
{0x02,0xb3,0xe7,0x72,0x21,0x66,0x95,0x84,0x5f,0xa9,0xdd,0xa4,0x19,0xfb,0x5d,0xac,0xa2,0x81,0x54,0xd8,0xaa,0x59,0xea,0x30,0x2f,0x05,0xe9,0x16,0x63,0x5e,0x47,0xb9,0xf6},//== #36
{0x02,0x7d,0x2c,0x03,0xc3,0xef,0x0a,0xec,0x70,0xf2,0xc7,0xe1,0xe7,0x54,0x54,0xa5,0xdf,0xdd,0x0e,0x1a,0xde,0xa6,0x70,0xc1,0xb3,0xa4,0x64,0x3c,0x48,0xad,0x0f,0x12,0x55},//== #37
{0x03,0xc0,0x60,0xe1,0xe3,0x77,0x1c,0xbe,0xcc,0xb3,0x8e,0x11,0x9c,0x24,0x14,0x70,0x2f,0x3f,0x51,0x81,0xa8,0x96,0x52,0x53,0x88,0x51,0xd2,0xe3,0x88,0x6b,0xdd,0x70,0xc6},//== #38
{0x02,0x2d,0x77,0xcd,0x14,0x67,0x01,0x9a,0x6b,0xf2,0x8f,0x73,0x75,0xd0,0x94,0x9c,0xe3,0x0e,0x6b,0x58,0x15,0xc2,0x75,0x8b,0x98,0xa7,0x4c,0x27,0x00,0xbc,0x00,0x65,0x43},//== #39
{0x03,0xa2,0xef,0xa4,0x02,0xfd,0x52,0x68,0x40,0x0c,0x77,0xc2,0x0e,0x57,0x4b,0xa8,0x64,0x09,0xed,0xed,0xee,0x7c,0x40,0x20,0xe4,0xb9,0xf0,0xed,0xbe,0xe5,0x3d,0xe0,0xd4},//== #40
{0x03,0xb3,0x57,0xe6,0x84,0x37,0xda,0x27,0x3d,0xcf,0x99,0x5a,0x47,0x4a,0x52,0x44,0x39,0xfa,0xad,0x86,0xfc,0x9e,0xff,0xc3,0x00,0x18,0x3f,0x71,0x4b,0x09,0x03,0x46,0x8b},//== #41
{0x03,0xee,0xc8,0x83,0x85,0xbe,0x9d,0xa8,0x03,0xa0,0xd6,0x57,0x97,0x98,0xd9,0x77,0xa5,0xd0,0xc7,0xf8,0x09,0x17,0xda,0xb4,0x9c,0xb7,0x3c,0x9e,0x39,0x27,0x14,0x2c,0xb6},//== #42
{0x02,0xa6,0x31,0xf9,0xba,0x0f,0x28,0x51,0x16,0x14,0x90,0x4d,0xf8,0x0d,0x7f,0x97,0xa4,0xf4,0x3f,0x02,0x24,0x9c,0x89,0x09,0xda,0xc9,0x22,0x76,0xcc,0xf0,0xbc,0xda,0xed},//== #43
{0x02,0x5e,0x46,0x6e,0x97,0xed,0x0e,0x79,0x10,0xd3,0xd9,0x0c,0xeb,0x03,0x32,0xdf,0x48,0xdd,0xf6,0x7d,0x45,0x6b,0x9e,0x73,0x03,0xb5,0x0a,0x3d,0x89,0xde,0x35,0x73,0x36},//== #44
{0x02,0x6e,0xca,0xbd,0x2d,0x22,0xfd,0xb7,0x37,0xbe,0x21,0x97,0x5c,0xe9,0xa6,0x94,0xe1,0x08,0xeb,0x94,0xf3,0x64,0x9c,0x58,0x6c,0xc7,0x46,0x1c,0x8a,0xbf,0x5d,0xa7,0x1a},//== #45
{0x03,0xfd,0x54,0x87,0x72,0x2d,0x25,0x76,0xcb,0x6d,0x70,0x81,0x42,0x6b,0x66,0xa3,0xe2,0x98,0x6c,0x1c,0xe8,0x35,0x8d,0x47,0x90,0x63,0xfb,0x5f,0x2b,0xb6,0xdd,0x58,0x49},//== #46
{0x02,0x3a,0x12,0xbd,0x3c,0xaf,0x0b,0x0f,0x77,0xbf,0x4e,0xea,0x8e,0x7a,0x40,0xdb,0xe2,0x79,0x32,0xbf,0x80,0xb1,0x9a,0xc7,0x2f,0x5f,0x5a,0x64,0x92,0x5a,0x59,0x41,0x96},//== #47
{0x02,0x91,0xbe,0xe5,0xcf,0x4b,0x14,0xc2,0x91,0xc6,0x50,0x73,0x2f,0xaa,0x16,0x60,0x40,0xe4,0xc1,0x8a,0x14,0x73,0x1f,0x9a,0x93,0x0c,0x1e,0x87,0xd3,0xec,0x12,0xde,0xbb},//== #48
{0x02,0x59,0x1d,0x68,0x2c,0x3d,0xa4,0xa2,0xa6,0x98,0x63,0x3b,0xf5,0x75,0x17,0x38,0xb6,0x7c,0x34,0x32,0x85,0xeb,0xdc,0x34,0x92,0x64,0x5c,0xb4,0x46,0x58,0x91,0x14,0x84},//== #49
{0x03,0xf4,0x6f,0x41,0x02,0x7b,0xbf,0x44,0xfa,0xfd,0x6b,0x05,0x90,0x91,0xb9,0x00,0xda,0xd4,0x1e,0x68,0x45,0xb2,0x24,0x1d,0xc3,0x25,0x4c,0x7c,0xdd,0x3c,0x5a,0x16,0xc6},//== #50
{0x02,0x8c,0x6c,0x67,0xbe,0xf9,0xe9,0xee,0xbe,0x6a,0x51,0x32,0x72,0xe5,0x0c,0x23,0x0f,0x0f,0x91,0xed,0x56,0x0c,0x37,0xbc,0x9b,0x03,0x32,0x41,0xff,0x6c,0x3b,0xe7,0x8f},//== #51
{0x03,0x74,0xc3,0x3b,0xd5,0x48,0xef,0x02,0x66,0x7d,0x61,0x34,0x18,0x92,0x13,0x4f,0xcf,0x21,0x66,0x40,0xbc,0x22,0x01,0xae,0x61,0x92,0x8c,0xd0,0x87,0x4f,0x63,0x14,0xa7},//== #52
{0x02,0x0f,0xaa,0xf5,0xf3,0xaf,0xe5,0x83,0x00,0xa3,0x35,0x87,0x4c,0x80,0x68,0x1c,0xf6,0x69,0x33,0xe2,0xa7,0xae,0xb2,0x83,0x87,0xc0,0xd2,0x8b,0xb0,0x48,0xbc,0x63,0x49},//== #53
{0x03,0x4a,0xf4,0xb8,0x1f,0x8c,0x45,0x0c,0x2c,0x87,0x0c,0xe1,0xdf,0x18,0x4a,0xff,0x12,0x97,0xe5,0xfc,0xd5,0x49,0x44,0xd9,0x8d,0x81,0xe1,0xa5,0x45,0xff,0xb2,0x25,0x96},//== #54
{0x03,0x85,0xa3,0x0d,0x84,0x13,0xaf,0x4f,0x8f,0x9e,0x63,0x12,0x40,0x0f,0x2d,0x19,0x4f,0xe1,0x4f,0x02,0xe7,0x19,0xb2,0x4c,0x3f,0x83,0xbf,0x1f,0xd2,0x33,0xa8,0xf9,0x63},//== #55
{0x03,0x3f,0x2d,0xb2,0x07,0x4e,0x32,0x17,0xb3,0xe5,0xee,0x30,0x53,0x01,0xee,0xeb,0xb1,0x16,0x0c,0x4f,0xa1,0xe9,0x93,0xee,0x28,0x01,0x12,0xf6,0x34,0x86,0x37,0x99,0x9a},//== #56
{0x02,0xa5,0x21,0xa0,0x7e,0x98,0xf7,0x8b,0x03,0xfc,0x1e,0x03,0x9b,0xc3,0xa5,0x14,0x08,0xcd,0x73,0x11,0x9b,0x5e,0xb1,0x16,0xe5,0x83,0xfe,0x57,0xdc,0x8d,0xb0,0x7a,0xea},//== #57
{0x03,0x11,0x56,0x94,0x42,0xe8,0x70,0x32,0x6c,0xee,0xc0,0xde,0x24,0xeb,0x54,0x78,0xc1,0x9e,0x14,0x6e,0xcd,0x9d,0x15,0xe4,0x66,0x64,0x40,0xf2,0xf6,0x38,0x87,0x5f,0x42},//== #58
{0x02,0x41,0x26,0x7d,0x2d,0x7e,0xe1,0xa8,0xe7,0x6f,0x8d,0x15,0x46,0xd0,0xd3,0x0a,0xef,0xb2,0x89,0x2d,0x23,0x1c,0xee,0x0d,0xde,0x77,0x76,0xda,0xf9,0xf8,0x02,0x14,0x85},//== #59
{0x03,0x48,0xe8,0x43,0xdc,0x5b,0x1b,0xd2,0x46,0xe6,0x30,0x9b,0x49,0x24,0xb8,0x15,0x43,0xd0,0x2b,0x16,0xc8,0x08,0x3d,0xf9,0x73,0xa8,0x9c,0xe2,0xc7,0xeb,0x89,0xa1,0x0d},//== #60
{0x02,0x49,0xa4,0x38,0x60,0xd1,0x15,0x14,0x3c,0x35,0xc0,0x94,0x54,0x86,0x3d,0x6f,0x82,0xa9,0x5e,0x47,0xc1,0x16,0x2f,0xb9,0xb2,0xeb,0xe0,0x18,0x6e,0xb2,0x6f,0x45,0x3f},//== #61
{0x03,0x23,0x1a,0x67,0xe4,0x24,0xca,0xf7,0xd0,0x1a,0x00,0xd5,0xcd,0x49,0xb0,0x46,0x49,0x42,0x25,0x5b,0x8e,0x48,0x76,0x6f,0x96,0x60,0x2b,0xdf,0xa4,0xea,0x14,0xfe,0xa8},//== #62
{0x03,0x65,0xec,0x29,0x94,0xb8,0xcc,0x0a,0x20,0xd4,0x0d,0xd6,0x9e,0xdf,0xe5,0x5c,0xa3,0x2a,0x54,0xbc,0xbb,0xaa,0x6b,0x0d,0xdc,0xff,0x36,0x04,0x93,0x01,0xa5,0x45,0x79},//== #63
{},
{0x02,0x30,0x21,0x0c,0x23,0xb1,0xa0,0x47,0xbc,0x9b,0xdb,0xb1,0x34,0x48,0xe6,0x7d,0xed,0xdc,0x10,0x89,0x46,0xde,0x6d,0xe6,0x39,0xbc,0xc7,0x5d,0x47,0xc0,0x21,0x6b,0x1b},//== #65
{},
{},
{},
{},
{0x02,0x90,0xe6,0x90,0x0a,0x58,0xd3,0x33,0x93,0xbc,0x10,0x97,0xb5,0xae,0xd3,0x1f,0x2e,0x4e,0x7c,0xbd,0x3e,0x54,0x66,0xaf,0x95,0x86,0x65,0xbc,0x01,0x21,0x24,0x84,0x83},//== #70
{},
{},
{},
{},
{0x03,0x72,0x6b,0x57,0x4f,0x19,0x3e,0x37,0x46,0x86,0xd8,0xe1,0x2b,0xc6,0xe4,0x14,0x2a,0xde,0xb0,0x67,0x70,0xe0,0xa2,0x85,0x6f,0x5e,0x4a,0xd8,0x9f,0x66,0x04,0x47,0x55},//== #75
{},
{},
{},
{},
{0x03,0x7e,0x12,0x38,0xf7,0xb1,0xce,0x75,0x7d,0xf9,0x4f,0xaa,0x9a,0x2e,0xb2,0x61,0xbf,0x0a,0xeb,0x9f,0x84,0xdb,0xf8,0x12,0x12,0x10,0x4e,0x78,0x93,0x1c,0x2a,0x19,0xdc},//== #80
{},
{},
{},
{},
{0x03,0x29,0xc4,0x57,0x4a,0x4f,0xd8,0xc8,0x10,0xb7,0xe4,0x2a,0x4b,0x39,0x88,0x82,0xb3,0x81,0xbc,0xd8,0x5e,0x40,0xc6,0x88,0x37,0x12,0x91,0x2d,0x16,0x7c,0x83,0xe7,0x3a},//== 1Kh22PvXERd2xpTQk3ur6pPEqFeckCJfAr#85
{},
{},
{},
{},
{0x03,0x5c,0x38,0xbd,0x9a,0xe4,0xb1,0x0e,0x8a,0x25,0x08,0x57,0x00,0x6f,0x3c,0xfd,0x98,0xab,0x15,0xa6,0x19,0x6d,0x9f,0x4d,0xfd,0x25,0xbc,0x7e,0xcc,0x77,0xd7,0x88,0xd5},//== 1L12FHH2FHjvTviyanuiFVfmzCy46RRATU#90
};

typedef struct hashtable_entry {
    uint32_t x2;
    uint32_t x3;
    #ifndef EXPONENT64
    uint32_t exponent;
    #else
    uint64_t exponent;
    #endif
} hashtable_entry;

hashtable_entry *table;

secp256k1_ge pubkeys[NUMPUBKEYS];

#ifdef TIME
time_t time1, time2;
#endif

uint64_t skip, g_max;

secp256k1_gej pt;
secp256k1_ge ptgstep;

secp256k1_ge P[256];

uint64_t GSTEP, HASH_SIZE;
unsigned int MEM_SIZE, CHECK_BITS, THREADS;
int DEBUG = 0;

uint64_t *status;

void *memoryInit(void *z);
void *searchKeys(void *z);

// Copy gej element
static void secp256k1_gej_copy(secp256k1_gej *r, secp256k1_gej *a) {
   r->infinity = a->infinity;
   r->x = a->x;
   r->y = a->y;
   r->z = a->z;
}

void usage(unsigned char *name) {
    printf("Usage: %s -b [BITS] -m [BITS] [OPTION]...\n\n\
 -m BITS                     memory size\n\
    31 for 48GB\n\
    30 for 24GB\n\
    29 for 12GB\n\
    28 for  6GB\n\
 -b BITS                     bits\n\
 -t THREADS                  number of threads\n\
 -d                          debug\n\
 -h                          show this help\n", name);
    exit(1);
}



int main(int argc, char **argv) {

    int c;
    while ((c = getopt(argc, argv, "hdt:b:m:")) != -1) {
        switch (c) {

            case 'b':
                CHECK_BITS = atoi(optarg);
                break;

            case 'm':
                MEM_SIZE = atoi(optarg);
                break;

            case 't':
                THREADS = atoi(optarg);
                break;

            case 'd':
                DEBUG++;
                break;

            case 'h':
                usage(argv[0]);
                return 0;

            default:
                return 1;
        }
    }

    if(!THREADS) THREADS = 1;

    status = malloc((uint64_t) THREADS*sizeof(status));

    if(!CHECK_BITS) {
        fprintf(stderr,"Number of bits not defined\n");
        usage(argv[0]);
        exit(1);
    } else if(CHECK_BITS<1 || CHECK_BITS>NUMPUBKEYS) {
        fprintf(stderr,"Number of bits not valid\n");
        exit(1);
    }

    if(!MEM_SIZE) {
        fprintf(stderr,"Memory bits not defined\n");
        usage(argv[0]);
        exit(1);
    #ifndef EXPONENT64
    } else if(MEM_SIZE>32) {
        fprintf(stderr,"Memory is limited to 32 bits. Compile with EXPONENT64 flag for 64bits.\n");
        exit(1);
    #endif
    } else if(MEM_SIZE<1 || MEM_SIZE>60) {
        fprintf(stderr,"Memory bits not valid\n");
        exit(1);
    }

    if(DEBUG)
        printf("Debug level: %d\n", DEBUG);

    GSTEP = ((uint64_t)1<<MEM_SIZE);
    HASH_SIZE = (2*GSTEP);
    if(DEBUG)
        printf("HASH_SIZE: 0x%lx\n", HASH_SIZE);

    table = malloc((uint64_t) HASH_SIZE*sizeof(hashtable_entry));

    if(!table) {
        fprintf(stderr,"Failed to allocate %luGB of memory\n", HASH_SIZE*sizeof(hashtable_entry)/1073741824);
        exit(1);
    }

    secp256k1_context *ctx = secp256k1_context_create(SECP256K1_CONTEXT_NONE);

    for (int i = 0; i < NUMPUBKEYS; i++) {
        secp256k1_eckey_pubkey_parse(&pubkeys[i], rawpubkeys[i], 33);
    }

    if(DEBUG)
        printf("GSTEP: 0x%lx\n", GSTEP);

    printf("Threads: %d\n", THREADS);
    printf("Check bit = %d only, pubkey is:\n", CHECK_BITS);
    for(uint32_t i=0;i<33;i++)
      printf("%02x",rawpubkeys[CHECK_BITS - 1][i]);
    printf("\n");


    int shift_gmax;
    shift_gmax = CHECK_BITS - MEM_SIZE*2 -1;
    if(shift_gmax <0 ){
       printf("Error, CHECK_BITS too small =%d, should >= %d\n",CHECK_BITS, MEM_SIZE*2 +1);
       return 1;
    }

    unsigned int skip_bits;
    skip_bits = CHECK_BITS - MEM_SIZE -2;

    skip  = (uint64_t)0x1 << skip_bits;
    g_max = ((uint64_t)0x1 << shift_gmax)* (uint64_t)(GSTEP);
    if(DEBUG)
        printf("skip %016lx gmax %016lx\n",skip,g_max);

    uint128_t rstart   = (uint128_t)skip *(uint128_t)(HASH_SIZE);
    uint128_t rend     = (uint128_t)g_max*(uint128_t)(HASH_SIZE)-1;
    uint64_t start_lo  = rstart;
    uint64_t start_hi  = rstart>>64;
    uint64_t end_lo    = rend;
    uint64_t end_hi    = rend>>64;

    uint64_t one_table_bytes;
    one_table_bytes = (uint64_t)&table[1] - (uint64_t)&table[0];

    printf("[+] Build Hash, MEM size (%d) = %dGB\n", MEM_SIZE, (uint32_t)(HASH_SIZE*one_table_bytes>>30));
    #ifdef TIME
    time1 = time(0);
    #endif

    // Precalculate 2**i table
    secp256k1_gej_set_ge(&pt, &secp256k1_ge_const_g);

    for(int i = 0; i<256; i++) {
        secp256k1_ge_set_gej(&P[i], &pt);
        secp256k1_gej_double_var(&pt, &pt, NULL);
    }

    // Memory Init
    pthread_t tid;
    for (int z = 0; z < THREADS; z++) {
        status[z] = 0;
        int *arg = malloc(sizeof(*arg));
        *arg = z;
        pthread_create(&tid, NULL, memoryInit, arg);
    }
    pthread_join(tid, NULL);

    #ifdef TIME
    time2 = time(NULL);
    sleep(1);
    printf("\rCompleted in %d seconds                      \n", (time2 - time1));
    #else
    printf("\rCompleted                                    \n");
    #endif

    secp256k1_gej_neg(&pt, &pt);
    secp256k1_gej_double_var(&pt, &pt, NULL);
    secp256k1_ge_set_gej(&ptgstep, &pt);

    printf("[+] Search bits = %d\n", CHECK_BITS);
    secp256k1_ge_set_gej(&P[0], &pt);
    for (uint64_t i = 0; i < skip_bits; i+=1) {
        secp256k1_gej_double_var(&pt, &pt, NULL);
        secp256k1_ge_set_gej(&P[i+1], &pt);
    }


    // Search Keys
    printf("[+] Search Keys....  from %lx%016lx to %lx%016lx\n",start_hi,start_lo, end_hi,end_lo);
    if(DEBUG)
        printf("SKIP: %lu - G_MAX: %lu\n", skip, g_max);

    pthread_t tid2;
    for (int z = 0; z < THREADS; z++) {
        status[z] = 0;
        int *arg = malloc(sizeof(*arg));
        *arg = z;
        pthread_create(&tid2, NULL, searchKeys, arg);
    }
    pthread_join(tid2, NULL);

    return 0;
}


void *memoryInit(void *arg) {

    int d = *((int*)arg);
    free(arg);

    uint64_t start = 1 + (GSTEP)/THREADS * (d);
    uint64_t end   = start + GSTEP/THREADS;

    if(d==THREADS-1) end = GSTEP;

    secp256k1_gej pt2;

    if(DEBUG)
        printf("Thread %02d - %lu - %lu - %lu\n", d, start, end, GSTEP);

    // Init 'pt2' in thread using binary P table.
    if(d!=0) {
        int pt_init = 0;
        for(uint64_t a = 0; a<64; a++) {
            if(start>>a & 0x1 == 0x1) {
                if(pt_init) {
                    secp256k1_gej_add_ge_var(&pt2, &pt2, &P[a], NULL);
                } else {
                    secp256k1_gej_set_ge(&pt2, &P[a]);
                    pt_init = 1;
                }
            }
        }
    } else {
        secp256k1_gej_set_ge(&pt2, &secp256k1_ge_const_g);
    }

    for (uint64_t i = start; i < end; i++) {

        #ifdef TIME
        if ((i % 200000)==0 && i>0 && (time(0)-time2)>0) {
            status[d] = i-start;
            if(d==0) {
                float tmpstatus = 0.0;
                for(int j=0; j<THREADS; j++) tmpstatus += (float) status[j]*100/(end-start);
                tmpstatus /= THREADS;
                printf("\r %02.2f%% - %d seconds. Remaining %.0f seconds. ", tmpstatus, (time(0) - time1), ((time(0) - time1)*(float)(100-tmpstatus))/(float)(tmpstatus));
                fflush(stdout);
            }
        }
        #else
        if ((i % 200000) == 0 && i>0) {
            status[d] = i-start;
            if(d==0) {
                float tmpstatus = 0;
                for(int j=0; j<THREADS; j++) tmpstatus += (float) status[j]*100/(end-start);
                tmpstatus /= THREADS;
                printf("\r %02.2f%%", tmpstatus);
                fflush(stdout);
            }
        }
        #endif

        secp256k1_fe x, zinv;
        secp256k1_fe_storage xst;

        secp256k1_fe_inv_var(&zinv, &pt2.z);
        secp256k1_fe_sqr(&zinv, &zinv);
        secp256k1_fe_mul(&x, &pt2.x, &zinv);
        secp256k1_fe_to_storage(&xst, &x);

        uint64_t entry = xst.n[0] & (HASH_SIZE-1);
        while (table[entry].exponent != 0) {
            entry = (entry + (xst.n[1] | 1)) & (HASH_SIZE - 1);
        }
        table[entry].exponent = i;
        table[entry].x2 = (uint32_t)xst.n[2];
        table[entry].x3 = (uint32_t)xst.n[3];

        secp256k1_gej_add_ge_var(&pt2, &pt2, &secp256k1_ge_const_g, NULL);
    }

    // Write final pt (GSTEP) in global var pt
    if(d==THREADS-1) {
        secp256k1_gej_copy(&pt, &pt2);
    }

}


void *searchKeys(void *arg) {
    int d = *((int*)arg);
    free(arg);

    uint64_t start = skip + (g_max-skip)/THREADS * (d);
    uint64_t end   = skip + (g_max-skip)/THREADS * (d+1);
    if(d==THREADS-1) end = g_max;

    // Thread variable por 'pt'
    secp256k1_gej pt2;
    secp256k1_gej_copy(&pt2, &pt);

    if(DEBUG)
        printf("Thread %02d - %lu - %lu - %lu\n", d, start, end, g_max);


    // Init 'pt2' in thread using binary P table.
    if(d!=0) {
        for(uint64_t a = 0; a<64; a++) {
            if((start-skip)>>a & 0x1 == 0x1) {
                secp256k1_gej_add_ge_var(&pt2, &pt2, &P[a], NULL);
            }
        }
    }

    for (uint64_t i = start; i < end; i++) {

        #ifdef TIME
        if ((i % 200000)==0 && i>0 && (time(0)-time2)>0) {
            status[d] = i-start;
            if(d==0) {
                float tmpstatus = 0.0;
                for(int j=0; j<THREADS; j++) tmpstatus += (float) status[j]*100/(end-start);
                tmpstatus /= THREADS;
                printf("\r %02.2f%% - %d seconds. Remaining %.0f seconds. ", tmpstatus, (time(0) - time2), ((time(0) - time2)*(float)(100-tmpstatus))/(float)(tmpstatus));
                fflush(stdout);
            }
        }
        #else
        if ((i % 200000) == 0 && i>0) {
            status[d] = i-start;
            if(d==0) {
                float tmpstatus = 0;
                for(int j=0; j<THREADS; j++) tmpstatus += (float) status[j]*100/(end-start);
                tmpstatus /= THREADS;
                printf("\r %02.2f%%", tmpstatus);
                fflush(stdout);
            }
        }
        #endif


        secp256k1_gej diff;
        secp256k1_fe x, zinv;
        secp256k1_fe_storage xst;

        secp256k1_gej_add_ge_var(&diff, &pt2, &pubkeys[CHECK_BITS - 1], NULL);
        secp256k1_fe_inv_var(&zinv, &diff.z);
        secp256k1_fe_sqr(&zinv, &zinv);
        secp256k1_fe_mul(&x, &diff.x, &zinv);
        secp256k1_fe_to_storage(&xst, &x);

        uint64_t entry = xst.n[0] & (HASH_SIZE-1);
        while (table[entry].exponent != 0) {
            if ((table[entry].x2 == (uint32_t)xst.n[2]) && (table[entry].x3 == (uint32_t)xst.n[3])) {

                uint128_t key = (uint128_t) i *  (uint128_t) (2 * GSTEP);

                uint128_t key1 = key - table[entry].exponent;
                uint128_t key2 = key + table[entry].exponent;

                uint64_t key1lo = key1;
                uint64_t key1hi = (key1 >> 64);
                uint64_t key2lo = key2;
                uint64_t key2hi = (key2 >> 64);
                printf("\nFound private key in thread %d %2d: %048lx%016lx or %048lx%016lx\n", d, CHECK_BITS, key1hi, key1lo, key2hi, key2lo);
                #ifdef TIME
                printf("Found in %d seconds. Total: %d seconds\n", (time(0) - time2), (time(0) - time1));
                #endif

                FILE *fp = fopen("key.log","a+");
                if (DEBUG)
                    fprintf(fp,"Found private, b=%02d i=%16lx, x 2 x %16lx, exp=%x\n", CHECK_BITS, (uint64_t)i, GSTEP, table[entry].exponent);
                fprintf(fp,"Found private key %2d:\n%048lx%016lx\n%048lx%016lx\n", CHECK_BITS, key1hi, key1lo, key2hi, key2lo);
                fclose(fp);
                exit(0);
                return 0;
            }
            entry = (entry + (xst.n[1] | 1)) & (HASH_SIZE - 1);
        }

        secp256k1_gej_add_ge_var(&pt2, &pt2, &ptgstep, NULL);
    }
}
